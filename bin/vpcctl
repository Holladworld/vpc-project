#!/bin/bash
# Main VPC CLI - Entry point for the VPC management system
# === PATH SETUP ===
# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# === IMPORT LIBRARIES ===
source "$PROJECT_ROOT/lib/vpc_core.sh"      # VPC creation/deletion functions
source "$PROJECT_ROOT/lib/subnet_manager.sh" # Subnet management functions  
source "$PROJECT_ROOT/lib/firewall.sh"       # Firewall rule functions
source "$PROJECT_ROOT/lib/peering.sh"        # VPC peering functions
source "$PROJECT_ROOT/config/defaults.sh"    # Configuration settings

# === MAIN COMMAND ROUTER ===
main() {    
    case "$1" in
        create-vpc)    create_vpc "$2" "$3" ;;  # Call create_vpc with args 2 and 3
        delete-vpc)    delete_vpc "$2" ;;       # Call delete_vpc with arg 2
        add-subnet)    add_subnet "$2" "$3" "$4" ;; # Call add_subnet with args 2,3,4
        list-vpcs)     list_vpcs ;;             # Call list_vpcs with no args
        *)             show_usage ;;            # Show help for unknown commands
    esac  
}

# === USAGE INFORMATION ===
show_usage() {
    echo "VPC Management System"
    echo "Usage: $0 {create-vpc|delete-vpc|add-subnet|list-vpcs}"
    echo ""
    echo "Examples:"
    echo "  sudo $0 create-vpc my-vpc 10.0.0.0/16"
    echo "  sudo $0 add-subnet my-vpc public 10.0.1.0/24"
    echo "  sudo $0 list-vpcs"
    echo "  sudo $0 delete-vpc my-vpc"
    
}

# === SCRIPT START ===
# Check if any arguments were provided
if [ $# -eq 0 ]; then
    # No arguments - show usage
    show_usage
else
    # Arguments provided - process them
    main "$@"
    
fi